pkgname=cloudflare-warp-bin
pkgver=2022.5.346
pkgrel=1
pkgdesc="Cloudflare Warp Client"
url="https://1.1.1.1"
license=("unknown")
depends=("glibc" "dbus" "lz4" "zstd" "xz" "nftables" "libgpg-error")
checkdepends=("coreutils")
arch=('x86_64')
provides=('warp-cli' 'warp-diag' 'warp-svc' 'warp-taskbar')

source=(
  "${pkgname}-${pkgver}-x86_64.deb::https://pkg.cloudflareclient.com/uploads/cloudflare_warp_2022_5_346_1_amd64_afbf7aeea3.deb"
)

validpgpkeys=('C068A2B5771775193CBE1F2F6E2DD2174FA1C3BA')

md5sums=('SKIP')
sha256sums=('SKIP')
install=$pkgname.install

build() {
  tar xzf data.tar.gz
}

package() {
  mkdir -p "${pkgdir}/usr/share"
  mkdir -p "${pkgdir}/etc"
  cp -R "${srcdir}/etc" "${pkgdir}/"
  cp -R "${srcdir}/"{bin,lib} "${pkgdir}/usr/"
  cp -R "${srcdir}/usr/lib" "${pkgdir}/usr/"
  cp -R "${srcdir}/usr/share/"{applications,icons}"/" "${pkgdir}/usr/share/"

  # Fix systemd unit
  sed -i \
    -e "s%ExecStart=/bin/warp-svc%ExecStart=/usr/bin/warp-svc%" \
    "${pkgdir}"/usr/lib/systemd/system/warp-svc.service

}
